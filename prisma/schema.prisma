// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// prisma/schema.prisma
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id      String  @id @db.Uuid
  name    String  @db.Text
  email   String  @unique @db.Text
  isCoach Boolean @default(false)

  modules      Module[]       @relation("UserModules")
  ownedWeeks   ScheduleWeek[] @relation("CoachWeeks")
  athleteWeeks ScheduleWeek[] @relation("AthleteWeeks")

  @@map("user")
}

model Module {
  id BigInt @id @default(autoincrement()) @db.BigInt

  ownerId String @map("owner") @db.Uuid
  owner   User   @relation("UserModules", fields: [ownerId], references: [id])

  name        String  @db.Text
  category    String  @db.Text
  subCategory String? @db.Text
  description String? @db.Text
  duration    Int?
  distance    Int?
  weight      Int?
  comment     String? @db.Text
  feeling     Int?
  sleepHours  Int?

  scheduleDays            ScheduleDay[]
  scheduleModuleFeedbacks ScheduleModuleFeedback[]

  @@map("module")
}

// One week, for one athlete, owned by one coach
model ScheduleWeek {
  id BigInt @id @default(autoincrement()) @db.BigInt

  ownerId String @map("owner") @db.Uuid
  owner   User   @relation("CoachWeeks", fields: [ownerId], references: [id])

  athleteId String @map("athlete") @db.Uuid
  athlete   User   @relation("AthleteWeeks", fields: [athleteId], references: [id])

  week  Int
  title String @default("") @db.Text

  days ScheduleDay[]

  @@map("scheduleWeek")
}

model ScheduleDay {
  id  BigInt @id @default(autoincrement()) @db.BigInt
  day Int

  // Foreign key to the week this day belongs to
  weekId BigInt?       @db.BigInt
  week   ScheduleWeek? @relation(fields: [weekId], references: [id])

  // Relation: a day has a list of modules (many-to-many)
  modules Module[]

  feedback ScheduleModuleFeedback[]

  @@map("scheduleDay")
}

model ScheduleModuleFeedback {
  id BigInt @id @default(autoincrement()) @db.BigInt

  moduleId      BigInt      @db.BigInt
  scheduleDayId BigInt      @db.BigInt
  module        Module      @relation(fields: [moduleId], references: [id])
  scheduleDay   ScheduleDay @relation(fields: [scheduleDayId], references: [id])

  distance   Int?
  duration   Int?
  weight     Int?
  comment    String? @db.Text
  feeling    Int?
  sleepHours Int?

  @@unique([moduleId, scheduleDayId])
  @@map("scheduleModuleFeedback")
}
